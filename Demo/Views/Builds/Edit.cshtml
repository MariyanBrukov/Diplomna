@model Demo.Models.Build
@{
    ViewData["Title"] = "Edit Build";
}

<h1 class="mb-4 text-center"><i class="fa-solid fa-pen"></i> Edit Build</h1>

<div class="card card-glow p-4">
    <form asp-action="Edit" id="buildForm">
        <input type="hidden" asp-for="Id" />

        <div class="mb-3">
            <label asp-for="BuildName" class="form-label"></label>
            <input asp-for="BuildName" class="form-control" />
            <span asp-validation-for="BuildName" class="text-danger"></span>
        </div>

        <div class="row">
            <div class="col-md-6 mb-3">
                <label asp-for="CPUId"></label>
                <select asp-for="CPUId" asp-items="ViewBag.CPUId" class="form-select part-dropdown" data-type="CPU"></select>
            </div>

            <div class="col-md-6 mb-3">
                <label asp-for="GPUId"></label>
                <select asp-for="GPUId" asp-items="ViewBag.GPUId" class="form-select part-dropdown" data-type="GPU"></select>
            </div>

            <div class="col-md-6 mb-3">
                <label asp-for="MotherboardId"></label>
                <select asp-for="MotherboardId" asp-items="ViewBag.MotherboardId" class="form-select part-dropdown" data-type="Motherboard"></select>
            </div>

            <div class="col-md-6 mb-3">
                <label asp-for="RAMId"></label>
                <select asp-for="RAMId" asp-items="ViewBag.RAMId" class="form-select part-dropdown" data-type="RAM"></select>
            </div>

            <div class="col-md-6 mb-3">
                <label asp-for="StorageId"></label>
                <select asp-for="StorageId" asp-items="ViewBag.StorageId" class="form-select part-dropdown" data-type="Storage"></select>
            </div>

            <div class="col-md-6 mb-3">
                <label asp-for="PowerSupplyId"></label>
                <select asp-for="PowerSupplyId" asp-items="ViewBag.PowerSupplyId" class="form-select part-dropdown" data-type="PowerSupply"></select>
            </div>

            <div class="col-md-6 mb-3">
                <label asp-for="CaseId"></label>
                <select asp-for="CaseId" asp-items="ViewBag.CaseId" class="form-select part-dropdown" data-type="Case"></select>
            </div>
        </div>

        <div class="mb-3">
            <label asp-for="TotalPrice" class="form-label"></label>
            <input asp-for="TotalPrice" id="TotalPrice" class="form-control" readonly />
        </div>

        <button type="submit" class="btn btn-fancy">
            <i class="fa-solid fa-save"></i> Save Changes
        </button>

        <a asp-action="Index" class="btn btn-outline-light ms-2">
            Back to List
        </a>
    </form>
</div>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />

    <script>
        // Example prices (same as Create view)
        const partPrices = {
            CPU: { 1: 160, 2: 420, 3: 140, 4: 400, 5: 600 },
            GPU: { 1: 300, 2: 550, 3: 270, 4: 750, 5: 1600 },
            Motherboard: { 1: 150, 2: 180, 3: 230, 4: 220, 5: 200 },
            RAM: { 1: 50, 2: 160, 3: 55, 4: 140, 5: 60 },
            Storage: { 1: 90, 2: 70, 3: 40, 4: 60, 5: 160 },
            PowerSupply: { 1: 100, 2: 50, 3: 120, 4: 70, 5: 250 },
            Case: { 1: 80, 2: 100, 3: 90, 4: 140, 5: 120 }
        };

        document.querySelectorAll('.part-dropdown').forEach(drop => {
            drop.addEventListener('change', calcTotal);
        });

        function calcTotal() {
            let total = 0;

            document.querySelectorAll('.part-dropdown').forEach(d => {
                const type = d.dataset.type;
                const val = d.value;

                if (val && partPrices[type][val]) {
                    total += partPrices[type][val];
                }
            });

            document.getElementById('TotalPrice').value = total.toFixed(2);
        }

        // Calculate initial total on page load (for existing selections)
        calcTotal();
    </script>
}
